function update(){var t=d3.select("#updateButton").property("value");return new RegExp("^.*"+t+".*","gi")}function loadCSV(){d3.csv("temperaturas-prueba.csv",function(t,a){function n(t){return t.split("-")[2]}datos=a,datos=a.filter(function(t){return String(t.fecha).match(update())}),datos.forEach(function(t){t.fecha=t.fecha,t.maxima=+t.maxima,t.minima=+t.minima,t.year=n(t.fecha)}),maxTemp=d3.max(datos,function(t){return t.maxima}),minTemp=d3.min(datos,function(t){return t.maxima}),pintando()})}function pintando(){var t=d3.select("body").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),a=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);xRange=d3.scale.linear().range([30,width]).domain([d3.min(datos,function(t){return t.year}),d3.max(datos,function(t){return t.year})]),yRange=d3.scale.linear().range([height,0]).domain([d3.min(datos,function(t){return t.maxima}),d3.max(datos,function(t){return t.maxima})]);var n=d3.range(1,5).map(function(t){return[t*width/5,50+Math.random()*(height-100)]});t.append("path").datum(n).attr("class","line");var e=d3.svg.axis().scale(xRange).orient("bottom").innerTickSize(-height).outerTickSize(0).tickPadding(15).tickFormat(d3.format("d")).ticks(20);t.append("g").attr("class","xAxis").attr("transform","translate(0,450)").call(e);var i=d3.svg.axis().scale(yRange).orient("left").innerTickSize(-width).outerTickSize(0).tickPadding(15).ticks(6);t.append("g").attr("class","yAxis").attr("transform","translate(30, 0)").call(i);d3.svg.line().x(function(t){return xRange(t.year)}).y(function(t){return yRange(t.maxima)}).interpolate("linear");t.selectAll("dot").data(datos).enter().append("circle").on("mouseover",function(t){a.transition().duration(200),a.style("opacity",1).html('<p class="tooltipYear">'+t.year+'<p/><p class="tooltipTemp">'+t.maxima+"ยบ<p/>").style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){a.transition().duration(500).style("opacity",0)}).transition().duration(1e3).ease("linear").style("r",function(t){return t.maxima===maxTemp?10*Math.sqrt(t.maxima/Math.PI):t.maxima===minTemp?10*Math.sqrt(t.maxima/Math.PI):4*Math.sqrt(t.maxima/Math.PI)}).style("fill",function(t){return t.maxima===maxTemp?"#70284a":t.maxima===minTemp?"#045275":color(t.maxima)}).attr("cx",function(t){return xRange(t.year)}).attr("cy",function(t){return yRange(t.maxima)})}var datos=[],margin={top:50,right:50,bottom:50,left:110},width=1300-margin.left-margin.right,height=550-margin.top-margin.bottom;widthBar=width/62;var color=d3.scale.linear().domain([20,35]).range(["#fcde9c","#e34f6f","#7c1d6f"]);loadCSV();