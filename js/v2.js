const dedicatoria="Dedicado a Maria del Carmen Tobajas Urieta y Agustín Aznar Gracia. Gracias por todo.";console.log(dedicatoria);const temp="ºC";function menu(){var t=document.querySelector(".overlay"),e=document.querySelector(".navegacion"),a=document.querySelector("body"),c=document.querySelectorAll(".navegacion-btn"),n=document.querySelector(".burger");function r(){n.classList.toggle("clicked"),t.classList.toggle("show"),e.classList.toggle("show"),a.classList.toggle("overflow")}for(document.querySelector(".burger").addEventListener("click",r),document.querySelector(".overlay").addEventListener("click",r),i=0;i<c.length;i++)c[i].addEventListener("click",function(){s()});function s(){t.classList.remove("show"),e.classList.remove("show"),n.classList.remove("clicked")}}menu();const scatterInput=()=>{const t=48,e=16,a=24,c=32;let n=0,r=0;const s=d3.select(".scatter-inputs"),i=s.select("svg"),o={};let l;const d=t=>t.split("-")[2],m=(t,e)=>{o.count.x.range([10,t]),o.count.y.range([e,-10])},u=t=>{const e=d3.axisBottom(o.count.x).tickPadding(10).tickFormat(d3.format("d")).tickSize(-r).ticks(20);t.select(".axis-x").attr("transform","translate(0,"+r+")").transition().duration(600).ease(d3.easeLinear).call(e);const a=d3.axisLeft(o.count.y).tickFormat(t=>t+"ºC").tickSize(-n).ticks(6);t.select(".axis-y").transition().duration(600).ease(d3.easeLinear).call(a)},p=l=>{const d=s.node().offsetWidth;n=d-c-e,r=500-t-a,i.attr("width",d).attr("height",500);const p="translate("+c+","+t+")",y=i.select(".scatter-inputs-container");y.attr("transform",p),m(n,r);const x=s.select(".scatter-inputs-container-dos").selectAll(".scatter-inputs-circles").data(l),f=x.enter().append("circle").attr("class","scatter-inputs-circles");x.merge(f).transition().duration(600).ease(d3.easeLinear).attr("cx",t=>o.count.x(t.year)).attr("cy",(t,e)=>e*(Math.random()*e)).attr("fill-opacity",1).transition().delay((t,e)=>10*e).duration(300).attr("cx",t=>o.count.x(t.year)).attr("cy",t=>o.count.y(t.minima)).attr("r",6).style("fill","#257d98"),u(y)};d3.select("#update").on("click",t=>{y()}),d3.select("#updateMin").on("click",t=>{x()});const y=()=>{let e=d3.select("#updateButtonDay").property("value"),a=d3.select("#updateButtonMonth").property("value");e<10&&(e=("0"+e).slice(-2)),a<10&&(a=("0"+a).slice(-2));let l=new RegExp("^.*"+(e+"-"+a)+".*","gi");d3.csv("csv/temperaturas.csv",(e,a)=>{(a=a.filter(t=>String(t.fecha).match(l))).forEach(t=>{t.fecha=t.fecha,t.maxima=+t.maxima,t.minima=+t.minima,t.year=d(t.fecha)}),o.count.x.range([10,n]),o.count.y.range([r,-10]);const p=d3.scaleTime().domain([d3.min(a,t=>t.year),d3.max(a,t=>t.year)]),y=d3.scaleLinear().domain([d3.min(a,t=>t.maxima),d3.max(a,t=>t.maxima)]);o.count={x:p,y:y};const x="translate("+c+","+t+")",f=i.select(".scatter-inputs-container");f.attr("transform",x),m(n,r);const h=s.select(".scatter-inputs-container-dos").selectAll(".scatter-inputs-circles").data(a),g=h.enter().append("circle").attr("class","scatter-inputs-circles");h.merge(g).transition().duration(600).ease(d3.easeLinear).attr("cx",t=>o.count.x(t.year)).attr("cy",t=>o.count.y(t.maxima)).attr("r",6).style("fill","#dc7176"),u(f)})},x=()=>{let t=d3.select("#updateButtonDay").property("value"),e=d3.select("#updateButtonMonth").property("value");t<10&&(t=("0"+t).slice(-2)),e<10&&(e=("0"+e).slice(-2));let a=new RegExp("^.*"+(t+"-"+e)+".*","gi");d3.csv("csv/temperaturas.csv",(t,e)=>{(e=e.filter(t=>String(t.fecha).match(a))).forEach(t=>{t.fecha=t.fecha,t.maxima=+t.maxima,t.minima=+t.minima,t.year=d(t.fecha)}),o.count.x.range([10,n]),o.count.y.range([r,-10]);const c=d3.scaleTime().domain([d3.min(e,t=>t.year),d3.max(e,t=>t.year)]),s=d3.scaleLinear().domain([d3.min(e,t=>t.minima),d3.max(e,t=>t.minima)]);o.count={x:c,y:s},p(e)})};window.addEventListener("resize",()=>{let t=d3.select("#updateButtonDay").property("value")+"-"+d3.select("#updateButtonMonth").property("value");d3.csv("csv/temperaturas.csv",(e,a)=>{(a=a.filter(e=>String(e.fecha).match(t))).forEach(t=>{t.fecha=t.fecha,t.maxima=+t.maxima,t.minima=+t.minima,t.year=d(t.fecha)}),o.count.x.range([10,n]),o.count.y.range([r,-10]);const c=d3.scaleTime().domain([d3.min(a,t=>t.year),d3.max(a,t=>t.year)]),s=d3.scaleLinear().domain([d3.min(a,t=>t.minima),d3.max(a,t=>t.minima)]);o.count={x:c,y:s},p(a)})}),d3.csv("csv/temperaturas.csv",(t,e)=>{t?console.log(t):(l=e,(l=e.filter(t=>String(t.fecha).match(/31-12/))).forEach(t=>{t.fecha=t.fecha,t.maxima=+t.maxima,t.minima=+t.minima,t.year=d(t.fecha)}),(()=>{const t=i.select(".scatter-inputs-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","scatter-inputs-container-dos")})(),(()=>{const t=d3.scaleLinear().domain([d3.min(l,t=>t.year),d3.max(l,t=>t.year)]),e=d3.scaleLinear().domain([d3.min(l,t=>t.minima),d3.max(l,t=>t.minima)]);o.count={x:t,y:e}})(),p(l))})};scatterInput();const areaTooltip=()=>{const t={top:24,right:24,bottom:24,left:48};let e=0,a=0;const c=d3.select(".temperatura-media"),n=c.select("svg"),r={};let s;const i=d3.bisector(t=>t.fecha).left,o=(t,e)=>{r.count.x.range([0,t]),r.count.y.range([e,0])},l=c=>{const n=d3.axisBottom(r.count.x).tickFormat(d3.format("d")).ticks(13);c.select(".axis-x").attr("transform","translate(0,"+a+")").call(n);const o=d3.axisLeft(r.count.y).tickFormat(t=>t+"ºC").ticks(6).tickSizeInner(-e);c.select(".axis-y").call(o);const l=c.select(".focus"),d=c.select(".overlay");l.append("line").attr("class","x-hover-line hover-line").attr("y1",0).attr("y2",a),l.append("line").attr("class","y-hover-line hover-line").attr("x1",e).attr("x2",e),l.append("circle").attr("class","circle-focus").attr("r",8),l.append("text").attr("class","text-focus").attr("x",-10).attr("y",-20).attr("dy",".31em"),d.attr("width",e+t.left+t.right).attr("height",a).on("mouseover",function(){l.style("display",null)}).on("mouseout",function(){l.style("display","none")}).on("mousemove",function(){const t=r.count.x.invert(d3.mouse(this)[0]),e=i(s,t,1),c=s[e-1],n=s[e],o=t-c.fecha>n.fecha-t?n:c;l.attr("transform",`translate(${r.count.x(o.fecha)},${r.count.y(o.temperatura)})`),l.select("text").text(o.temperatura),l.select(".x-hover-line").attr("y2",a-r.count.y(o.temperatura)),l.select(".y-hover-line").attr("x1",0-r.count.x(o.fecha))})};function d(i){const d=c.node().offsetWidth;e=d-t.left-t.right,a=600-t.top-t.bottom,n.attr("width",d).attr("height",600);const m="translate("+t.left+","+t.top+")",u=n.select(".temperatura-media-container");u.attr("transform",m);const p=d3.area().x(t=>r.count.x(t.fecha)).y0(a).y1(t=>r.count.y(t.temperatura)).curve(d3.curveCardinal.tension(.6));o(e,a);const y=c.select(".temperatura-media-container-dos").selectAll(".area").data([s]),x=y.enter().append("path").attr("class","area area-anual");y.merge(x).attr("d",p),l(u)}window.addEventListener("resize",()=>{d()}),d3.csv("csv/temperatura-media.csv",(t,e)=>{t?console.log(t):((s=e).forEach(t=>{t.fecha=t.fecha,t.temperatura=+t.temperatura}),(()=>{const t=n.select(".temperatura-media-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","temperatura-media-container-dos"),t.append("rect").attr("class","overlay"),t.append("g").attr("class","focus").style("display","none")})(),(()=>{const t=d3.scaleTime().domain([d3.min(s,t=>t.fecha),d3.max(s,t=>t.fecha)]),e=d3.scaleLinear().domain([13,18]);r.count={x:t,y:e}})(),d())})};areaTooltip();