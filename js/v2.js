const dedicatoria="Dedicado a Maria del Carmen Tobajas Urieta y Agustín Aznar Gracia. Gracias por todo.";console.log(dedicatoria);const temp="ºC",widthMobile=window.innerWidth>0?window.innerWidth:screen.width;function menu(){var t=document.querySelector(".overlay"),a=document.querySelector(".navegacion"),e=document.querySelector("body"),n=document.querySelectorAll(".navegacion-btn"),s=document.querySelector(".burger");function c(){s.classList.toggle("clicked"),t.classList.toggle("show"),a.classList.toggle("show"),e.classList.toggle("overflow")}for(document.querySelector(".burger").addEventListener("click",c),document.querySelector(".overlay").addEventListener("click",c),i=0;i<n.length;i++)n[i].addEventListener("click",function(){o()});function o(){t.classList.remove("show"),a.classList.remove("show"),s.classList.remove("clicked")}}menu();const scatterInput=()=>{const t=48,a=16,e=24,n=32;let s=0,c=0;const i=d3.select(".scatter-inputs"),o=i.select("svg"),r={};let l;const d=t=>t.split("-")[2],m=(t,a)=>{r.count.x.range([10,t]),r.count.y.range([a,-10])},u=t=>{const a=d3.axisBottom(r.count.x).tickPadding(10).tickFormat(d3.format("d")).tickSize(-c).ticks(20);t.select(".axis-x").attr("transform","translate(0,"+c+")").transition().duration(600).ease(d3.easeLinear).call(a);const e=d3.axisLeft(r.count.y).tickFormat(t=>t+"ºC").tickSize(-s).ticks(6);t.select(".axis-y").transition().duration(600).ease(d3.easeLinear).call(e)},p=l=>{const d=i.node().offsetWidth;s=d-n-a,c=500-t-e,o.attr("width",d).attr("height",500);const p="translate("+n+","+t+")",x=o.select(".scatter-inputs-container");x.attr("transform",p),m(s,c);const y=i.select(".scatter-inputs-container-dos").selectAll(".scatter-inputs-circles").data(l),h=y.enter().append("circle").attr("class","scatter-inputs-circles");y.merge(h).transition().duration(600).ease(d3.easeLinear).attr("cx",t=>r.count.x(t.year)).attr("cy",(t,a)=>a*(Math.random()*a)).attr("fill-opacity",1).transition().delay((t,a)=>10*a).duration(300).attr("cx",t=>r.count.x(t.year)).attr("cy",t=>r.count.y(t.minima)).attr("r",6).style("fill","#257d98"),u(x)};d3.select("#update").on("click",t=>{x()}),d3.select("#updateMin").on("click",t=>{y()});const x=()=>{let a=d3.select("#updateButtonDay").property("value"),e=d3.select("#updateButtonMonth").property("value");a<10&&(a=("0"+a).slice(-2)),e<10&&(e=("0"+e).slice(-2));let l=new RegExp("^.*"+(a+"-"+e)+".*","gi");d3.csv("csv/temperaturas.csv",(a,e)=>{(e=e.filter(t=>String(t.fecha).match(l))).forEach(t=>{t.fecha=t.fecha,t.maxima=+t.maxima,t.minima=+t.minima,t.year=d(t.fecha)}),r.count.x.range([10,s]),r.count.y.range([c,-10]);const p=d3.scaleTime().domain([d3.min(e,t=>t.year),d3.max(e,t=>t.year)]),x=d3.scaleLinear().domain([d3.min(e,t=>t.maxima),d3.max(e,t=>t.maxima)]);r.count={x:p,y:x};const y="translate("+n+","+t+")",h=o.select(".scatter-inputs-container");h.attr("transform",y),m(s,c);const f=i.select(".scatter-inputs-container-dos").selectAll(".scatter-inputs-circles").data(e),g=f.enter().append("circle").attr("class","scatter-inputs-circles");f.merge(g).transition().duration(600).ease(d3.easeLinear).attr("cx",t=>r.count.x(t.year)).attr("cy",t=>r.count.y(t.maxima)).attr("r",6).style("fill","#dc7176"),u(h)})},y=()=>{let t=d3.select("#updateButtonDay").property("value"),a=d3.select("#updateButtonMonth").property("value");t<10&&(t=("0"+t).slice(-2)),a<10&&(a=("0"+a).slice(-2));let e=new RegExp("^.*"+(t+"-"+a)+".*","gi");d3.csv("csv/temperaturas.csv",(t,a)=>{(a=a.filter(t=>String(t.fecha).match(e))).forEach(t=>{t.fecha=t.fecha,t.maxima=+t.maxima,t.minima=+t.minima,t.year=d(t.fecha)}),r.count.x.range([10,s]),r.count.y.range([c,-10]);const n=d3.scaleTime().domain([d3.min(a,t=>t.year),d3.max(a,t=>t.year)]),i=d3.scaleLinear().domain([d3.min(a,t=>t.minima),d3.max(a,t=>t.minima)]);r.count={x:n,y:i},p(a)})};window.addEventListener("resize",()=>{let t=d3.select("#updateButtonDay").property("value")+"-"+d3.select("#updateButtonMonth").property("value");d3.csv("csv/temperaturas.csv",(a,e)=>{(e=e.filter(a=>String(a.fecha).match(t))).forEach(t=>{t.fecha=t.fecha,t.maxima=+t.maxima,t.minima=+t.minima,t.year=d(t.fecha)}),r.count.x.range([10,s]),r.count.y.range([c,-10]);const n=d3.scaleTime().domain([d3.min(e,t=>t.year),d3.max(e,t=>t.year)]),i=d3.scaleLinear().domain([d3.min(e,t=>t.minima),d3.max(e,t=>t.minima)]);r.count={x:n,y:i},p(e)})}),d3.csv("csv/temperaturas.csv",(t,a)=>{t?console.log(t):(l=a,(l=a.filter(t=>String(t.fecha).match(/31-12/))).forEach(t=>{t.fecha=t.fecha,t.maxima=+t.maxima,t.minima=+t.minima,t.year=d(t.fecha)}),(()=>{const t=o.select(".scatter-inputs-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","scatter-inputs-container-dos")})(),(()=>{const t=d3.scaleLinear().domain([d3.min(l,t=>t.year),d3.max(l,t=>t.year)]),a=d3.scaleLinear().domain([d3.min(l,t=>t.minima),d3.max(l,t=>t.minima)]);r.count={x:t,y:a}})(),p(l))})};scatterInput();const areaTooltip=()=>{const t={top:24,right:24,bottom:24,left:48};let a=0,e=0;const n=d3.select(".temperatura-media"),s=n.select("svg"),c={};let i;const o=d3.bisector(t=>t.fecha).left,r=(t,a)=>{c.count.x.range([0,t]),c.count.y.range([a,0])},l=n=>{const s=d3.axisBottom(c.count.x).tickFormat(d3.format("d")).ticks(13);n.select(".axis-x").attr("transform","translate(0,"+e+")").call(s);const r=d3.axisLeft(c.count.y).tickFormat(t=>t+"ºC").ticks(6).tickSizeInner(-a);n.select(".axis-y").call(r);const l=n.select(".focus"),d=n.select(".overlay");l.append("line").attr("class","x-hover-line hover-line").attr("y1",0).attr("y2",e),l.append("line").attr("class","y-hover-line hover-line").attr("x1",a).attr("x2",a),l.append("circle").attr("class","circle-focus").attr("r",8),l.append("text").attr("class","text-focus").attr("x",-10).attr("y",-20).attr("dy",".31em"),d.attr("width",a+t.left+t.right).attr("height",e).on("mouseover",function(){l.style("display",null)}).on("mouseout",function(){l.style("display","none")}).on("mousemove",function(){const t=c.count.x.invert(d3.mouse(this)[0]),a=o(i,t,1),n=i[a-1],s=i[a],r=t-n.fecha>s.fecha-t?s:n;l.attr("transform",`translate(${c.count.x(r.fecha)},${c.count.y(r.temperatura)})`),l.select("text").text(r.temperatura),l.select(".x-hover-line").attr("y2",e-c.count.y(r.temperatura)),l.select(".y-hover-line").attr("x1",0-c.count.x(r.fecha))})};function d(o){const d=n.node().offsetWidth;a=d-t.left-t.right,e=600-t.top-t.bottom,s.attr("width",d).attr("height",600);const m="translate("+t.left+","+t.top+")",u=s.select(".temperatura-media-container");u.attr("transform",m);const p=d3.area().x(t=>c.count.x(t.fecha)).y0(e).y1(t=>c.count.y(t.temperatura)).curve(d3.curveCardinal.tension(.6));r(a,e);const x=n.select(".temperatura-media-container-dos").selectAll(".area").data([i]),y=x.enter().append("path").attr("class","area area-anual");x.merge(y).attr("d",p),l(u)}window.addEventListener("resize",()=>{d()}),d3.csv("csv/temperatura-media.csv",(t,a)=>{t?console.log(t):((i=a).forEach(t=>{t.fecha=t.fecha,t.temperatura=+t.temperatura}),(()=>{const t=s.select(".temperatura-media-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","temperatura-media-container-dos"),t.append("rect").attr("class","overlay"),t.append("g").attr("class","focus").style("display","none")})(),(()=>{const t=d3.scaleTime().domain([d3.min(i,t=>t.fecha),d3.max(i,t=>t.fecha)]),a=d3.scaleLinear().domain([13,18]);c.count={x:t,y:a}})(),d())})};areaTooltip();const mediaMensualMaxima=()=>{const t={top:16,right:16,bottom:24,left:32};let a=0,e=0;const n=d3.select(".media-mensual-maxima-chart"),s=n.select("svg");let c={};const i=(t,a)=>{c.count.x.range([0,t]),c.count.y.range([a,0])},o=t=>{const n=d3.axisBottom(c.count.x).tickPadding(5).tickFormat(d3.format("d")).ticks(13);t.select(".axis-x").attr("transform","translate(0,"+e+")").transition().duration(300).ease(d3.easeLinear).call(n);const s=d3.axisLeft(c.count.y).tickPadding(5).tickFormat(t=>t+"ºC").tickSize(-a).ticks(6);t.select(".axis-y").transition().duration(300).ease(d3.easeLinear).call(s)};function r(r){const l=n.node().offsetWidth;a=l-t.left-t.right,e=400-t.top-t.bottom,s.attr("width",l).attr("height",400);const d="translate("+t.left+","+t.top+")",m=s.select(".media-mensual-maxima-container");m.attr("transform",d);const u=d3.area().x(t=>c.count.x(t.fecha)).y0(e).y1(t=>c.count.y(t.max));i(a,e);const p=n.select(".media-mensual-maxima-container-bis").selectAll(".area").data([r]),x=p.enter().append("path").attr("class","area area-temperatura-mensual");p.merge(x).transition().duration(600).ease(d3.easeLinear).attr("d",u),o(m)}window.addEventListener("resize",()=>{d3.csv("csv/total-media-limpio.csv",(t,a)=>{const e=d3.select("#mes-mensual-maxima").select("select").property("value");r(a=a.filter(t=>String(t.mes).match(e)))})}),d3.csv("csv/total-media-limpio.csv",(t,a)=>{t?console.log(t):((a=a.filter(t=>String(t.mes).match(/Enero/))).forEach(t=>{t.max=+t.max,t.fecha=t.fecha,t.mes=t.mes}),(()=>{const t=s.select(".media-mensual-maxima-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","media-mensual-maxima-container-bis")})(),(()=>{const t=d3.scaleTime().domain([1951,2018]),a=d3.scaleLinear().domain([0,20]);c.count={x:t,y:a}})(),r(a))}),d3.csv("csv/total-media-limpio.csv",(t,n)=>{if(t)console.log(t);else{const t=d3.nest().key(t=>t.mes).entries(n),s=d3.select("#mes-mensual-maxima");s.append("select").selectAll("option").data(t).enter().append("option").attr("value",t=>t.key).text(t=>t.key),s.on("change",function(){!function(t){d3.csv("csv/total-media-limpio.csv",(n,s)=>{(s=s.filter(function(a){return String(a.mes).match(t)})).forEach(t=>{t.max=+t.max}),c.count.x.range([0,a]),c.count.y.range([e,0]);const i=d3.scaleTime().domain([1951,2018]),o=d3.scaleLinear().domain([d3.min(s,t=>t.max-5),d3.max(s,t=>t.max+5)]);c.count={x:i,y:o},r(s)})}(d3.select(this).select("select").property("value"))})}})};mediaMensualMaxima();const mediaMensualMinima=()=>{const t={top:16,right:16,bottom:24,left:32};let a=0,e=0;const n=d3.select(".media-mensual-minima-chart"),s=n.select("svg");let c={};const i=(t,a)=>{c.count.x.range([0,t]),c.count.y.range([a,0])},o=t=>{const n=d3.axisBottom(c.count.x).tickPadding(5).tickFormat(d3.format("d")).ticks(13);t.select(".axis-x").attr("transform","translate(0,"+e+")").transition().duration(300).ease(d3.easeLinear).call(n);const s=d3.axisLeft(c.count.y).tickPadding(5).tickFormat(t=>t+"ºC").tickSize(-a).ticks(6);t.select(".axis-y").transition().duration(300).ease(d3.easeLinear).call(s)};function r(r){const l=n.node().offsetWidth;a=l-t.left-t.right,e=400-t.top-t.bottom,s.attr("width",l).attr("height",400);const d="translate("+t.left+","+t.top+")",m=s.select(".media-mensual-minima-container");m.attr("transform",d);const u=d3.area().x(t=>c.count.x(t.fecha)).y0(e).y1(t=>c.count.y(t.max));i(a,e);const p=n.select(".media-mensual-minima-container-bis").selectAll(".area").data([r]),x=p.enter().append("path").attr("class","area area-temperatura-mensual-minima");p.merge(x).transition().duration(600).ease(d3.easeLinear).attr("d",u),o(m)}window.addEventListener("resize",()=>{d3.csv("csv/total-media-limpio.csv",(t,a)=>{const e=d3.select("#mes-mensual-minima").select("select").property("value");r(a=a.filter(t=>String(t.mes).match(e)))})}),d3.csv("csv/total-media-limpio.csv",(t,a)=>{t?console.log(t):((a=a.filter(t=>String(t.mes).match(/Enero/))).forEach(t=>{t.max=+t.max,t.fecha=t.fecha,t.mes=t.mes}),(()=>{const t=s.select(".media-mensual-minima-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","media-mensual-minima-container-bis")})(),(()=>{const t=d3.scaleTime().domain([1951,2018]),a=d3.scaleLinear().domain([0,20]);c.count={x:t,y:a}})(),r(a))}),d3.csv("csv/total-media-limpio.csv",(t,n)=>{if(t)console.log(t);else{const t=d3.nest().key(t=>t.mes).entries(n),s=d3.select("#mes-mensual-minima");s.append("select").selectAll("option").data(t).enter().append("option").attr("value",t=>t.key).text(t=>t.key),s.on("change",function(){!function(t){d3.csv("csv/total-media-limpio.csv",(n,s)=>{(s=s.filter(function(a){return String(a.mes).match(t)})).forEach(t=>{t.max=+t.max}),c.count.x.range([0,a]),c.count.y.range([e,0]);const i=d3.scaleTime().domain([1951,2018]),o=d3.scaleLinear().domain([d3.min(s,t=>t.max-5),d3.max(s,t=>t.max+5)]);c.count={x:i,y:o},r(s)})}(d3.select(this).select("select").property("value"))})}})};mediaMensualMinima();const tropicalesHorizontal=()=>{const t=24,a=24,e=24,n=24;let s=0,c=0;const i=d3.select(".noches-tropicales-chart"),o=i.select("svg"),r={};let l;const d=i.append("div").attr("class","tooltip-container").style("opacity",1);const m=l=>{const m=i.node().offsetWidth;s=m-n-a,c=600-t-e,o.attr("width",m).attr("height",600);const u="translate("+n+","+t+")",p=o.select(".noches-tropicales-chart-container");p.attr("transform",u),((t,a)=>{r.count.x.range([0,t]),r.count.y.range([a,0])})(s,c);const x=i.select(".noches-tropicales-chart-container-bis").selectAll(".bar-vertical").data(l),y=x.enter().append("rect").attr("class","bar-vertical bar-bgc4");if(x.merge(y).on("mouseover",t=>{d.transition().duration(300).style("opacity",1),d.html('<div class="tooltip-lluvia-mes-container"><p class="tooltip-lluvia-mes">Lluvia acumulada en '+t.dias+'<span class="tooltip-lluvia-mes-total">: '+t.fecha+'mm</span><p/><p class="tooltip-lluvia-mes">Lluvia acumulada en '+t.precipitacion_anual+'<span class="tooltip-lluvia-mes-total">: '+t.fecha+"mm</span><p/></div>")}).on("mouseout",t=>{d.style("opacity",0)}).attr("width",s/l.length-1).attr("x",t=>r.count.x(t.fecha)).attr("y",t=>r.count.y(t.dias)).attr("height",t=>c-r.count.y(t.dias)),(t=>{const a=d3.axisBottom(r.count.x).tickFormat(d3.format("d"));t.select(".axis-x").attr("transform","translate(0,"+c+")").call(a);const e=d3.axisLeft(r.count.y).tickFormat(d3.format("d")).ticks(5).tickSize(-s);t.select(".axis-y").call(e)})(p),s>768){var h=[{note:{label:"En 1991 se superan por primera vez las 30 noches",wrap:430},data:{anyo:"1991",dias:33},dy:-15,dx:-142},{note:{label:"En 2003 se superan por primera vez las 40 noches",wrap:430},data:{anyo:"2003",dias:47},dy:-10,dx:-252},{note:{label:"El 14 de junio de 2009 se registra la mínima más alta, 24.7ºC",wrap:500},data:{anyo:"2009",dias:40},dy:-10,dx:-252}].map(function(t){return t.note=Object.assign({},t.note),t.subject={radius:6},t});window.makeAnnotations=d3.annotation().annotations(h).type(d3.annotationCalloutCircle).accessors({x:t=>r.count.x(t.anyo),y:t=>r.count.y(t.dias)}).accessorsInverse({fecha:t=>r.count.x.invert(t.x),dia:t=>r.count.y.invert(t.y)}).on("subjectover",function(t){t.type.a.selectAll("g.annotation-connector, g.annotation-note").classed("hidden",!1)}).on("subjectout",function(t){t.type.a.selectAll("g.annotation-connector, g.annotation-note").classed("hidden",!0)}),o.append("g").attr("class","annotation-test").call(makeAnnotations),o.selectAll("g.annotation-connector, g.annotation-note").classed("hidden",!0)}};window.addEventListener("resize",()=>{m(l)}),d3.csv("csv/tropicales.csv",(t,a)=>{t?console.log(t):((l=a).forEach(t=>{t.anyo=t.fecha,t.dia=t.dias,t.diaTooltip=function(t){return t.replace(/^0+/,"")}(t.dia)}),(()=>{const t=o.select(".noches-tropicales-chart-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","noches-tropicales-chart-container-bis")})(),(()=>{const t=d3.scaleLinear().domain([d3.min(l,t=>t.fecha),d3.max(l,t=>t.fecha)]),a=d3.scaleLinear().domain([0,60]);r.count={x:t,y:a}})(),m(l))})};tropicalesHorizontal();